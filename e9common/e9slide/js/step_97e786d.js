define("step:widget/ads/brand-ads/brand-ads.js",function(a,e,n){var t=a("common:widget/lib/tangram/base/base.js");n.exports.init=function(a){var e=[];e.push("type=brand_ad"),e.push("page=album"),e.push("aid="+a),e.push("eidenc="+F.context("eid")),e.push("t="+1*new Date);var n=t.dom.query(".brand-pro-wrap a"),i="/static/article/ui/log/log.gif";t.each(n,function(a,n){t.on(a,"click",function(){var a=document.createElement("img");a.src=i+"?"+e.join("&"),window["___article_brand_"+1*new Date+n]=a})})}});
;define("step:widget/content/content.js",function(e,n,t){e("common:widget/lib/tangram/base/base.js"),e("common:widget/lib/fis/event/event.js").eventCenter;t.exports.init=function(){}});
;define("step:widget/pager/pager.js",function(require,exports,module){var T=require("common:widget/lib/tangram/base/base.js"),ec=require("common:widget/lib/fis/event/event.js").eventCenter,log=require("common:widget/ui/log/log.js");module.exports=function(){var STEP_NUM_PER_PAGE=12,totalItems=T.q("item"),stepItems=T.q("step"),totalStep=0,totalPage=0,currentStepIndex=0,currentPage=0,currentPageStart=0,switching=!1,stepLogOption={},hasLastStepInit=!1,showPagenate=function(){for(var e=0,t=totalItems.length;t>e;e++)T.dom.setStyle(totalItems[e],"display","none");for(var r=Math.min(currentPageStart+STEP_NUM_PER_PAGE,totalItems.length),e=currentPageStart;r>e;e++)T.dom.setStyle(totalItems[e],"display","block")},bindEvent=function(){T.array.each(stepItems,function(e,t){var r=e.children[0];if(T.dom.hasClass(r,"preview")){var n,o,a=T.dom.create("p",{"class":"preview-data"}),i=T.dom.create("div",{"class":"triangle-icon"}),s=T.dom.getAttr(r,"data"),c=T.dom.getAttr(r,"data-type");0==c?a.innerHTML=s:1==c&&(n=F.context("hiori")+s+".jpg",o='<img src="'+n+'" width="80px" height="60px">',T.dom.insertHTML(a,"afterBegin",o),T.dom.addClass(a,"preview-img")),T.on(r,"mouseover",function(){T.dom.insertAfter(a,r),T.dom.insertAfter(i,r)}),T.on(r,"mouseout",function(){T.dom.remove(a),T.dom.remove(i)})}T.on(r,"click",function(){currentStepIndex!=t&&setCurrentPage(t)})}),T.g("pre")&&T.on("pre","click",function(){currentPageStart>0&&(currentPageStart=Math.max(currentPageStart-STEP_NUM_PER_PAGE,0),showPagenate())}),T.g("next")&&T.on("next","click",function(){currentPageStart+STEP_NUM_PER_PAGE<totalItems.length&&(currentPageStart=Math.min(currentPageStart+STEP_NUM_PER_PAGE,totalItems.length-STEP_NUM_PER_PAGE),showPagenate())}),ec.on("stepPlay.left",function(){setCurrentPage(currentStepIndex-1)}),ec.on("stepPlay.right",function(){setCurrentPage(currentStepIndex+1)}),T.on(document,"keydown",function(e){var t=e||window.event;T.event.stopPropagation(t),37==t.keyCode&&(stepLogOption.keyboard_left=1,ec.fire("stepPlay.left")),39==t.keyCode&&(stepLogOption.keyboard_right=1,ec.fire("stepPlay.right"))});var e=T.browser.firefox,t=e?"DOMMouseScroll":"mousewheel";T.on("body",t,function(e){T.event.preventDefault(e);var t=T.event.getTarget(e),r=T.dom.query("#step-item-"+currentStepIndex+" .tangram-scrollpanel-main");if(!(r.length>0&&T.dom.contains(r[0],t))){var n=T.event.get(e),o=n.detail?-n.detail:n.wheelDelta;0>o?(stepLogOption.mousewheel_forward=1,ec.fire("stepPlay.right")):(stepLogOption.mousewheel_backward=1,ec.fire("stepPlay.left"))}}),T.on("left-cover","mouseover",function(e){T.event.stopPropagation(e),T.dom.addClass("left-cover","cover-hover")}),T.on("left-cover","mouseout",function(e){T.event.stopPropagation(e),T.dom.removeClass("left-cover","cover-hover")}),T.on("left-cover","click",function(e){T.event.stopPropagation(e),stepLogOption.left_btn_click=1,ec.fire("stepPlay.left")}),T.on("right-cover","mouseover",function(e){T.event.stopPropagation(e),T.dom.addClass("right-cover","cover-hover")}),T.on("right-cover","mouseout",function(e){T.event.stopPropagation(e),T.dom.removeClass("right-cover","cover-hover")}),T.on("right-cover","click",function(e){T.event.stopPropagation(e),stepLogOption.right_btn_click=1,ec.fire("stepPlay.right")})},setCurrentPage=function(e,t){0>e||e>=totalStep||switching||(switching=!0,changeStepStyle(e),gotoStep(e),initCurrentStep(e),t?stepLogOption.page_show=1:(stepLogOption.page_request=1,stepLogOption.cid=F.context("cid")),log.send(location.href,1012,stepLogOption),stepLogOption={},currentStepIndex=e)},changeStepStyle=function(e){T.q("current")[0]&&T.dom.removeClass(T.q("current")[0],"current"),T.dom.addClass(T.dom.children(stepItems[e])[0],"current");var t=T.array.indexOf(totalItems,stepItems[e]),r=t-currentPageStart;if(r>=0){if(STEP_NUM_PER_PAGE>r)return;for(;t>=currentPageStart+STEP_NUM_PER_PAGE;)currentPageStart=Math.min(currentPageStart+STEP_NUM_PER_PAGE,totalItems.length-STEP_NUM_PER_PAGE)}else do currentPageStart=Math.max(currentPageStart-STEP_NUM_PER_PAGE,0);while(currentPageStart>t);showPagenate()},gotoStep=function(e){var t=920*(e-currentStepIndex),r=920*currentStepIndex,n=runtimes=20,o=20,a=setInterval(function(){r+=t/n,T.dom.setStyle("step-play-list","left",-r),--runtimes||(clearInterval(a),switching=!1)},o)},initCurrentStep=function(e){getStepImgsInfo(e),totalStep-1>e?(getStepImgsInfo(e+1),T.show("right-cover")):T.hide("right-cover"),0==e?T.hide("left-cover"):(getStepImgsInfo(e-1),T.show("left-cover"))},getStepImgsInfo=function(e){if(e===totalStep-1&&!hasLastStepInit)return initLastPage(),hasLastStepInit=!0,void 0;var t=T.dom.query(".step-img-wrapper",T.g("step-item-"+e));T.array.each(t,function(e){var t=T.dom.getAttr(e,"imgLoaded");if("0"==t){T.dom.setAttr(e,"imgLoaded",1);var r=T.dom.query("img",e)[0];loadImage(r,T.dom.getAttr(r,"data-src"),function(e){T.dom.setAttr(e.item,"imgLoaded",2),T.dom.setAttr(e.img,"_height",parseInt(r.height)),T.dom.setAttr(e.img,"_width",parseInt(r.width));var t=T.dom.query(".img-cover",e.item)[0],n=T.dom.query(".inner-img-cover",e.item)[0];T.dom.setStyles(n,{height:r.height,width:r.width}),T.dom.setStyles(t,{height:r.height,width:r.width}),ec.fire("adjustSingleImg",{container:e.item,resizedContainerHeight:T.dom.getStyle(e.item,"height")})},{item:e,img:r})}})},resizeImg=function(e,t,r){var n=new Image;n.onload=function(){var o=this.width,a=this.height,i=0,s=0;o/a>=t/r?(a=t/o*a,o=t,i=(r-a)/2):(o=r/a*o,a=r,s=(t-o)/2),e.style.left=s+"px",e.style.top=i+"px",e.style.width=o+"px",e.style.height=a+"px",n.onload=null,n=null},n.src=e.src},initLastPage=function(){T.ajax.get("/asyncreq?method=getRecommand&eidEnc="+F.context("eid"),function(xhr,msg){var data=eval("("+msg+")");if(0==data.errno){var recommends=data.data.recommendExpList;if(!recommends)return;var i=0,l=Math.min(recommends.length,5),htmlStr=[],item=null;for(htmlStr.push("<h3>你可能对这些经验也感兴趣</h3>");l>i;i++)item=recommends[i],htmlStr.push('<div class="recommend-exp '+(i==l-1?" last":"")+'">'),htmlStr.push('<div class="recommend-exp-image">'),htmlStr.push('<a class="recommend-exp-link" href="/album/'+item.eidEnc+'.html" target="_self">'),htmlStr.push('<img class="recommand-img" alt="'+item.title+'" src="'+F.context("hi")+item.picEnc+'.jpg" width="120px" height="90px">'),htmlStr.push('<div class="img-border"></div>'),htmlStr.push("</a>"),htmlStr.push("</div>"),htmlStr.push('<a class="recommend-exp-title" href="/album/'+item.eidEnc+'.html" target="_self" title="'+item.title+'">'+item.title+"</a>"),htmlStr.push("</div>");T.g("recommend-list-container").innerHTML=htmlStr.join(""),T.array.each(T.g("recommend-list-container").getElementsByTagName("img"),function(e){resizeImg(e,120,90)})}}),T.on("replay-step","click",function(e){T.event.preventDefault(e),stepLogOption.reread_btn_click=1,setCurrentPage(0)}),T.on("replay-step-e","click",function(e){T.event.preventDefault(e),stepLogOption.reread_btn_click=1,setCurrentPage(0)});var replayImg=T.dom.query(".replay-img .recommand-img")[0],src=T.dom.getAttr(replayImg,"data-src");replayImg.src=src},loadImage=function(e,t,r,n){e||(e=new Image),e.onload=function(){r&&r(n),e.onload=null},e.src=t};return{init:function(e){return stepItems.length<2?!1:(totalStep=stepItems.length,totalPage=Math.ceil(totalItems.length/STEP_NUM_PER_PAGE),currentStepIndex=e,currentPage=parseInt(T.array.indexOf(totalItems,stepItems[e])/STEP_NUM_PER_PAGE)+1,currentPageStart=(currentPage-1)*STEP_NUM_PER_PAGE,showPagenate(),totalItems.length<=STEP_NUM_PER_PAGE&&T.dom.setStyle("step-pager-list","width",40*totalItems.length),bindEvent(),setCurrentPage(e,1),void 0)}}}()});
;define("step:widget/ui/scrollbar/scrollbar.js",function(l,r,e){var o=l("common:widget/lib/tangram/ui/ScrollPanel/ScrollPanel.js");e.exports=o});
;define("step:widget/ui/adjust-size/adjust-size.js",function(e,t,i){var r=e("common:widget/lib/tangram/base/base.js"),o=e("common:widget/lib/fis/event/event.js").eventCenter,h=e("step:widget/ui/scrollbar/scrollbar.js");i.exports=function(){var e=600,t=1024,i=130,a=920,n=16,g={"brief-text-area":{height:330,width:325,spaceHeight:0},"img-text-area":{height:390,width:270,spaceHeight:52},"img-text-area-withhead":{height:390,width:270,spaceHeight:107}},d={"brief-info-img":{width:200,height:330},"step-only-img":{width:450,height:325},"step-one-img":{width:480,height:346},"step-two-img":{width:480,height:167},"step-three-img-top":{width:235,height:176},"step-three-img-bottom":{width:480,height:155}},s={},l=function(t){var o=t.ph,a=o/(e-i),n=r.q("step-text-wrapper");if(null==n||0==n.length)return!1;r.array.each(n,function(e){var t=r.dom.getAttr(e,"texttype");if(t){var i=Math.max(e.offsetHeight,e.scrollHeight),o=g[t];if(i<o.height){if("brief-text-area"==t){var n=(o.height*a-i)/2;r.dom.setStyles(e,{position:"absolute",top:n}),r.dom.setStyle("brief-left-quote","top",n),r.dom.setStyle("brief-right-quote","bottom",o.height*a-i-n)}}else{var d=r.dom.getAttr(e,"id");if(r.dom.setStyle(e,"height",o.height*a-o.spaceHeight),s[d])s[d].update({container:d,element:d,overflow:"overflow-y"});else{var l=new h({container:d,element:d,overflow:"overflow-y"});l.render(d),s[d]=l}}}});var d=r.q("step-item-text-inner");if(null==d||0==d.length)return!1;var l=r.page.getViewHeight();r.array.each(d,function(e){var t=r.dom.query(".smaller-text-left",e)[0],i=r.dom.query(".bigger-text-left",e)[0],o=r.dom.query(".smaller-text-right",e),a=r.dom.query(".bigger-text-right",e);if(o.length>0){var n=o[0];if(n.offsetHeight>336&&!r.dom.hasAttr(n,"hasLoaded")){var g=r.dom.getAttr(n,"id");r.dom.setStyle(n,"height",336);var d=new h({container:g,element:g,overflow:"overflow-y"});d.render(g),s[g]=d,r.dom.setAttr(n,"hasLoaded",1)}}if(a.length>0){var m=a[0];if(m.offsetHeight>448&&!r.dom.hasAttr(m,"hasLoaded")){var g=r.dom.getAttr(m,"id");r.dom.setStyle(m,"height",448);var d=new h({container:g,element:g,overflow:"overflow-y"});d.render(g),s[g]=d,r.dom.setAttr(m,"hasLoaded",1)}}if(l>700){r.hide(t),r.show(i);var f=r.dom.query(".step-smaller-text-right-contanier",e),p=r.dom.query(".step-bigger-text-right-contanier",e);f.length>0&&r.hide(f[0]),p.length>0&&r.show(p[0])}else{r.show(t),r.hide(i);var f=r.dom.query(".step-smaller-text-right-contanier",e),p=r.dom.query(".step-bigger-text-right-contanier",e);f.length>0&&r.show(f[0]),p.length>0&&r.hide(p[0])}})},m=function(e){var t=e.container,i=parseInt(e.resizedContainerHeight),o=r.dom.getAttr(t,"stepType"),h=r.dom.query("img",t)[0],a=r.dom.query(".img-cover",t)[0],n=r.dom.getAttr(h,"_height");n>i?r.dom.setStyle(a,"margin-top",(i-n)/2):r.dom.setStyle(a,"margin-top",0),("brief-info-img"==o||"step-only-img"==o)&&r.dom.setStyles(a,{"margin-top":(i-n)/2,left:(d[o].width-r.dom.getAttr(h,"_width"))/2})},f=function(t){var h=t.ph,a=h/(e-i),n=r.q("step-img-wrapper");return null==n||0==n.length?!1:(r.array.each(n,function(e){var t=r.dom.getAttr(e,"stepType");if(t){var i=d[t].height*a;r.dom.setStyle(e,"height",i);var h=r.dom.getAttr(e,"imgLoaded");"2"==h&&o.fire("adjustSingleImg",{container:e,resizedContainerHeight:i})}}),void 0)},p=function(t){var o=t.ph,h=t.pw,g=0,d=(h-(a+n))/2;r.dom.setStyle("body","height",o),r.dom.setStyles("left-cover",{height:o,width:d}),r.dom.setStyles("right-cover",{height:o,width:d+n}),r.dom.setStyle("step-play-container","left",d),r.g("brief-writer-info")&&r.dom.setStyle("brief-writer-info","height",469*o/(e-i)),r.g("brief-right-quote")&&r.dom.setStyle("brief-right-quote","display","block"),g=h>=1140?d:110,r.dom.setStyle("exp-title","left",g)};return{init:function(e){r.object.extend(g,e),o.on("adjustSize",function(e){p(e),l(e),f(e)}),o.on("adjustSingleImg",function(e){m(e)})},resize:function(h){var a=r.page.getViewHeight(),n=r.page.getViewWidth();a=Math.max(a,e)-i,n=Math.max(n,t),(a>e-i||n>t||h)&&o.fire("adjustSize",{ph:a,pw:n})}}}()});
;define("step:widget/ui/brand-ads/brand-ads.js",function(a,e,n){var t=a("common:widget/lib/tangram/base/base.js");n.exports.init=function(a){var e=t.dom.query(".brand-pro-wrap a"),n="/static/article/ui/log/log.gif";t.each(e,function(e){t.on(e,"click",function(){var e=[];e.push("type=brand_ad"),e.push("page=album"),e.push("aid="+a),e.push("eidenc="+F.context("eid"));var t=Math.round((new Date).getTime()/1e3);e.push("t="+t);var i=document.createElement("img");i.src=n+"?"+e.join("&"),window["___article_brand_"+1*new Date]=i})})}});
;define("step:widget/ui/step-album/step-album.js",function(t,e,i){var n=t("common:widget/lib/tangram/base/base.js"),s=t("common:widget/ui/album/album.js");i.exports.init=function(){n.on("step-play-list","click",function(t){n.event.stopPropagation(t);var e=n.event.getTarget(t);if(n.dom.hasClass(e,"inner-img-cover")){for(var i=n.dom.getAttr(e,"data-src"),a=F.context("stepPic").stepPic,o=0,c=a.length;c>o&&!(a[o].src.indexOf(i)>-1);o++);s.initAlbum(o,F.context("stepPic"))}})}});
;define("step:widget/ui/user-guide/user-guide.js",function(e,i,t){var d=e("common:widget/lib/tangram/base/base.js");e("common:widget/lib/tangram/fx/fadeOut/fadeOut.js"),t.exports={init:function(){if(d.cookie.get("isStepGuided"))return!1;var e=d.dom.create("div",{"class":"guide-container"});e.innerHTML="<img src='images/user-guide.gif'/>";var i=d.g("step-play-container");i.appendChild(e),d.dom.setStyle(e,"top",(i.offsetHeight-220)/2),setTimeout(function(){d.fx.fadeOut(e),d.cookie.set("isStepGuided","done",{path:"/"})},2e3)}}});
;define("step:widget/ui/vote-favor/vote-favor.js",function(e,i,t){var n=e("common:widget/lib/tangram/base/base.js"),o=e("common:widget/ui/dialog/dialog.js"),a=(e("common:widget/ui/log/log.js"),e("common:widget/ui/favor/favor.js")),d=(e("common:widget/ui/error/error.js"),e("common:widget/ui/ajax/ajax.js"),e("common:widget/lib/fis/event/event.js").eventCenter),s={eidEnc:"",feedbackData:{useful:{id:"",type:4,hadFeedback:!1,hasClass:"voted"},favor:{id:"",type:0,hadFeedback:!1,hasClass:"favored"}},init:function(e,i,t){if(null!==e&&""!==e&&null!==i&&""!==i){var o=this,a=o.feedbackData;a.useful.id=e,a.favor.id=i,a.favor.hadFeedback=t,o.eidEnc=F.context("eid"),n.cookie.get(o.eidEnc)&&(n.dom.addClass(a.useful.id,a.useful.hasClass),a.useful.hadFeedback=!0),o.bindEvent(a.useful),o.bindEvent(a.favor)}},bindEvent:function(e){var i=this,s=e.id,r=function(t){var a=[];a.push("method=feedback"),a.push("eidEnc="+F.context("eid")),a.push("BdStoken="+F.context("BdStoken")),a.push("bdstt="+F.context("bdstt")),a.push("type=4"),t&&a.push("isCost=1"),a=a.join("&"),d.fire("login.check",{isLogin:function(){var d=F.context("isLogin");return d?(n.ajax.post("/submit/exp",a,function(a,d){if(""!==d){var s=n.json.parse(d);if(0==s.errno){var c=n.dom.query("#vote-btn .num");if(c){var u=parseInt(c.innerHTML);c.innerHTML=u+1}if(t)return;i.hasFeedback(e)}else 2001==s.errno?o.confirm("经验提示",{info:'<div class="exp-has-used">您已对该篇经验进行了投票，再次投票需要消耗20财富值？</div>',width:300,height:120,onconfirm:function(){r(!0)}}):2040==s.errno?o.alert("经验提示",{info:'<p class="exp-tip">您的财富值不够</p>',width:300,height:120}):2041==s.errno&&o.alert("经验提示",{info:'<p class="exp-tip">您不能给自己的经验投票</p>',width:300,height:120})}}),void 0):(window.location.reload(!0),void 0)}})};n.event.on(s,"click",function(){if(e.hadFeedback||this.className.indexOf(e.hasClass)>-1,e.type){if(e.hadFeedback=!0,F.context("feedbackSuc")>=F.context("MAX_SUC_FAIL_TIMES"))return o.alert("提示",{info:"数量已达上限",width:300,height:200}),void 0;r(),n.sio.callByBrowser("http://like.baidu.com/set?key="+F.context("eid")+"&cb=setVoteData&type=0&like=1&pid=4&index=0&sub_index=0&random="+Math.random()),window.setVoteData=function(){}}else{var i=function(){t.exports.hasFeedback(e)};a.favor(F.context("eid"),i)}})},hasFeedback:function(e){var i=this,t=e.id,o=n.dom.query("#"+t+" .num")[0];o.innerHTML=parseInt(o.innerHTML)+1,n.dom.addClass(t,e.hasClass),e.type&&n.cookie.set(i.eidEnc,1,{path:"/"})}};t.exports=s});